<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>气象监测 | Hans362 's Lab</title>
    <link rel="shortcut icon" type="image/ico"
        href="https://cdn.jsdelivr.net/gh/hans362/image-hosting@master/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32"
        href="https://cdn.jsdelivr.net/gh/hans362/image-hosting@master/favicon-32x32.png" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="description" itemprop="description" content="Hans362 的气象监测站" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/suka.css@0.1.2" />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
</head>

<body>
    <div class="container sk-pt-8">
        <h1 class="h3 text-center sk-mt-3">气象监测</h1>
    </div>
    <div class="container sk-mt-8">
        <nav class="nav nav-pills nav-justified">
            <a id="24h" class="nav-link active" href="#">最近24小时</a>
            <a id="7d" class="nav-link" href="#">最近7天</a>
            <a id="30d" class="nav-link" href="#">最近30天</a>
            <a id="90d" class="nav-link" href="#">最近90天</a>
            <a id="all" class="nav-link" href="#">所有时间</a>
        </nav>
    </div>
    <div id="baro" class="container sk-mt-8" style="width: 100%; height: 400px"></div>
    <script type="text/javascript">
        var baroChart = echarts.init(document.getElementById("baro"));
        var option = {
            tooltip: {
                trigger: "axis",
                position: function (pt) {
                    return [pt[0], "10%"];
                },
            },
            title: {
                left: "center",
                text: "气压（百帕）",
            },
            xAxis: {
                type: "time",
                boundaryGap: false,
            },
            yAxis: {
                type: "value",
                boundaryGap: [0, "100%"],
                min: "dataMin",
                max: "dataMax",
            },
            dataZoom: [
                {
                    type: "inside",
                    start: 0,
                    end: 100,
                },
                {
                    start: 0,
                    end: 100,
                },
            ],
            series: [
                {
                    name: "气压（百帕）",
                    type: "line",
                    smooth: true,
                    symbol: "none",
                    areaStyle: {},
                    data: [],
                },
            ],
        };
        baroChart.showLoading();
        baroChart.setOption(option);

        function refresh_data(type, st, ed) {
            var Chart = echarts.init(document.getElementById(type));
            Chart.showLoading();
            $.get(
                "https://firebase-mirror.vercel.app/" +
                type +
                ".json?orderBy=%22timeStamp%22&startAt=" +
                st +
                "&endAt=" +
                ed
            ).done(function (rawData) {
                var data = [];
                $.each(rawData, function (index, single) {
                    var timeStamp = single["timeStamp"] * 1000;
                    var value = single[type + "Value"];
                    data.push([timeStamp, value]);
                });
                data.sort(function (a, b) {
                    return a[0] - b[0];
                });
                Chart.hideLoading();
                Chart.setOption({
                    series: [
                        {
                            data: data,
                        },
                    ],
                });
            });
        }

        refresh_data('baro', Math.round(Date.now() * 0.001 - 24 * 3600), Math.round(Date.now() * 0.001));

        $('#24h').on('click', function () {
            $('.nav-link').removeClass('active');
            $('#24h').addClass('active');
            refresh_data('baro', Math.round(Date.now() * 0.001 - 24 * 3600), Math.round(Date.now() * 0.001));
        });

        $('#7d').on('click', function () {
            $('.nav-link').removeClass('active');
            $('#7d').addClass('active');
            refresh_data('baro', Math.round(Date.now() * 0.001 - 24 * 3600 * 7), Math.round(Date.now() * 0.001));
        });

        $('#30d').on('click', function () {
            $('.nav-link').removeClass('active');
            $('#30d').addClass('active');
            refresh_data('baro', Math.round(Date.now() * 0.001 - 24 * 3600 * 30), Math.round(Date.now() * 0.001));
        });

        $('#90d').on('click', function () {
            $('.nav-link').removeClass('active');
            $('#90d').addClass('active');
            refresh_data('baro', Math.round(Date.now() * 0.001 - 24 * 3600 * 90), Math.round(Date.now() * 0.001));
        });

        $('#all').on('click', function () {
            $('.nav-link').removeClass('active');
            $('#all').addClass('active');
            refresh_data('baro', 0, Math.round(Date.now() * 0.001));
        });

        $(window).on('resize', function () {
            baroChart.resize();
        });
    </script>
    <p class="text-center">Data collected from Minhang, Shanghai</p>
</body>

</html>