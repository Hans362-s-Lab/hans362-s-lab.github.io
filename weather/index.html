<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
    <title>气象监测 | Hans362 's Lab</title>
    <link rel="shortcut icon" type="image/ico"
        href="https://cdn.jsdelivr.net/gh/hans362/image-hosting@master/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32"
        href="https://cdn.jsdelivr.net/gh/hans362/image-hosting@master/favicon-32x32.png" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="description" itemprop="description" content="Hans362 的气象监测站" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/suka.css@0.1.2" />
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.1.2/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
</head>

<body>
    <div class="container sk-pt-8">
        <h1 class="h3 text-center sk-mt-3">气象监测</h1>
    </div>
    <div id="main" class="container sk-mt-8" style="width: 100%; height: 400px"></div>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById("main"));
        var option = {
            tooltip: {
                trigger: "axis",
                position: function (pt) {
                    return [pt[0], "10%"];
                },
            },
            title: {
                left: "center",
                text: "气压（百帕）",
            },
            xAxis: {
                type: "time",
                boundaryGap: false,
            },
            yAxis: {
                type: "value",
                boundaryGap: [0, "100%"],
                min: "dataMin",
                max: "dataMax",
            },
            dataZoom: [
                {
                    type: "inside",
                    start: 0,
                    end: 100,
                },
                {
                    start: 0,
                    end: 100,
                },
            ],
            series: [
                {
                    name: "气压（百帕）",
                    type: "line",
                    smooth: true,
                    symbol: "none",
                    areaStyle: {},
                    data: [],
                },
            ],
        };
        myChart.showLoading();
        myChart.setOption(option);
        $.get(
            "https://firebase-mirror.vercel.app/baro.json?orderBy=%22timeStamp%22&startAt=0&endAt=" +
            Math.round(Date.now() * 0.001)
        ).done(function (baroData) {
            var data = [];
            $.each(baroData, function (index, baro) {
                var timeStamp = baro["timeStamp"] * 1000;
                var baroValue = baro["baroValue"];
                data.push([timeStamp, baroValue]);
            });
            data.sort(function (a, b) {
                return a[0] - b[0];
            });
            myChart.hideLoading();
            myChart.setOption({
                series: [
                    {
                        name: "气压（百帕）",
                        type: "line",
                        smooth: true,
                        symbol: "none",
                        areaStyle: {},
                        data: data,
                    },
                ],
            });
        });
        $(window).on('resize', function () {
            myChart.resize();
        });
    </script>
    <p class="text-center">Data collected from Minhang, Shanghai</p>
</body>

</html>